---
apiVersion: v1
kind: Secret
metadata:
  name: affine-secret
  namespace: productivity
type: Opaque
stringData:
  # Database Configuration
  INIT_POSTGRES_DBNAME: affine
  INIT_POSTGRES_HOST: postgres-rw.data.svc.cluster.local
  INIT_POSTGRES_USER: ${AFFINE_POSTGRES_USER}
  INIT_POSTGRES_PASS: ${AFFINE_POSTGRES_PASSWORD}
  INIT_POSTGRES_SUPER_PASS: ${POSTGRES_SUPER_PASS}
  DATABASE_URL: postgres://${AFFINE_POSTGRES_USER}:${AFFINE_POSTGRES_PASSWORD}@postgres-rw.data.svc.cluster.local/affine

  # Redis Configuration
  REDIS_SERVER_HOST: dragonfly.data.svc.cluster.local
  REDIS_SERVER_PORT: "6379"

  # Admin Account
  AFFINE_ADMIN_EMAIL: ${AFFINE_ADMIN_EMAIL}
  AFFINE_ADMIN_PASSWORD: ${AFFINE_ADMIN_PASSWORD}

  # OIDC Configuration
  OAUTH_OIDC_ISSUER: https://sso.${SECRET_DOMAIN}/application/o/affine
  OAUTH_OIDC_CLIENT_ID: ${AFFINE_OAUTH_CLIENT_ID}
  OAUTH_OIDC_CLIENT_SECRET: ${AFFINE_OAUTH_CLIENT_SECRET}
  OAUTH_OIDC_SCOPE: openid email profile
  OAUTH_OIDC_CLAIM_MAP_ID: preferred_username
  OAUTH_OIDC_CLAIM_MAP_EMAIL: email

  # Server Configuration
  TZ: ${TIMEZONE}
  NODE_ENV: production
  AFFINE_INDEXER_ENABLED: "false"
  AFFINE_SERVER_EXTERNAL_URL: https://affine.${SECRET_DOMAIN}
  AFFINE_SERVER_HTTPS: "true"
