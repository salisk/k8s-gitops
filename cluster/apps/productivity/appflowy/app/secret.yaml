---
# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/v1/secret.json
apiVersion: v1
kind: Secret
metadata:
  name: appflowy-secret
  namespace: productivity
type: Opaque
stringData:
  # Postgres Init (creates database and user)
  INIT_POSTGRES_DBNAME: appflowy
  INIT_POSTGRES_HOST: postgres-rw.data.svc.cluster.local
  INIT_POSTGRES_USER: appflowy
  INIT_POSTGRES_PASS: "${APPFLOWY_POSTGRES_PASSWORD}"
  INIT_POSTGRES_SUPER_PASS: "${POSTGRES_SUPER_PASS}"

  # Domain Configuration
  FQDN: "appflowy.${SECRET_DOMAIN}"
  SCHEME: "https"
  WS_SCHEME: "wss"
  APPFLOWY_BASE_URL: "https://appflowy.${SECRET_DOMAIN}"
  APPFLOWY_WEBSOCKET_BASE_URL: "wss://appflowy.${SECRET_DOMAIN}/ws"

  # Database Configuration
  POSTGRES_HOST: "postgres-rw.data.svc.cluster.local"
  POSTGRES_USER: "appflowy"
  POSTGRES_PASSWORD: "${APPFLOWY_POSTGRES_PASSWORD}"
  POSTGRES_PORT: "5432"
  POSTGRES_DB: "appflowy"
  APPFLOWY_DATABASE_URL: "postgresql://appflowy:${APPFLOWY_POSTGRES_PASSWORD}@postgres-rw.data.svc.cluster.local:5432/appflowy"
  APPFLOWY_DATABASE_MAX_CONNECTIONS: "40"
  GOTRUE_DATABASE_URL: "postgresql://appflowy:${APPFLOWY_POSTGRES_PASSWORD}@postgres-rw.data.svc.cluster.local:5432/appflowy"

  # Redis Configuration
  REDIS_HOST: "dragonfly.data.svc.cluster.local"
  REDIS_PORT: "6379"
  APPFLOWY_REDIS_URI: "redis://dragonfly.data.svc.cluster.local:6379"
  ADMIN_FRONTEND_REDIS_URL: "redis://dragonfly.data.svc.cluster.local:6379"

  # MinIO/S3 Configuration
  AWS_ACCESS_KEY: "${APPFLOWY_MINIO_ACCESS_KEY}"
  AWS_SECRET: "${APPFLOWY_MINIO_SECRET_KEY}"
  APPFLOWY_S3_USE_MINIO: "true"
  APPFLOWY_S3_CREATE_BUCKET: "true"
  APPFLOWY_S3_MINIO_URL: "http://minio.default.svc.cluster.local:9000"
  APPFLOWY_S3_ACCESS_KEY: "${APPFLOWY_MINIO_ACCESS_KEY}"
  APPFLOWY_S3_SECRET_KEY: "${APPFLOWY_MINIO_SECRET_KEY}"
  APPFLOWY_S3_BUCKET: "appflowy"
  APPFLOWY_S3_PRESIGNED_URL_ENDPOINT: "https://minio.${SECRET_DOMAIN}"

  # GoTrue Authentication
  GOTRUE_ADMIN_EMAIL: "${APPFLOWY_ADMIN_EMAIL}"
  GOTRUE_ADMIN_PASSWORD: "${APPFLOWY_ADMIN_PASSWORD}"
  GOTRUE_JWT_SECRET: "${APPFLOWY_JWT_SECRET}"
  GOTRUE_JWT_EXP: "604800"
  API_EXTERNAL_URL: "https://appflowy.${SECRET_DOMAIN}/gotrue"
  GOTRUE_MAILER_AUTOCONFIRM: "true"
  GOTRUE_DISABLE_SIGNUP: "false"
  GOTRUE_RATE_LIMIT_EMAIL_SENT: "100"
  APPFLOWY_GOTRUE_BASE_URL: "http://appflowy-gotrue.productivity.svc.cluster.local:9999"
  ADMIN_FRONTEND_GOTRUE_URL: "http://appflowy-gotrue.productivity.svc.cluster.local:9999"

  # SMTP Configuration (Optional)
  GOTRUE_SMTP_HOST: "smtp-relay.default.svc.cluster.local"
  GOTRUE_SMTP_PORT: "2525"
  GOTRUE_SMTP_USER: ""
  GOTRUE_SMTP_PASS: ""
  GOTRUE_SMTP_ADMIN_EMAIL: "appflowy@${SECRET_DOMAIN}"
  APPFLOWY_MAILER_SMTP_HOST: "smtp-relay.default.svc.cluster.local"
  APPFLOWY_MAILER_SMTP_PORT: "2525"
  APPFLOWY_MAILER_SMTP_USERNAME: ""
  APPFLOWY_MAILER_SMTP_EMAIL: "appflowy@${SECRET_DOMAIN}"
  APPFLOWY_MAILER_SMTP_PASSWORD: ""
  APPFLOWY_MAILER_SMTP_TLS_KIND: "none"

  # AppFlowy Cloud Settings
  APPFLOWY_ACCESS_CONTROL: "true"
  APPFLOWY_WEBSOCKET_MAILBOX_SIZE: "6000"
  ADMIN_FRONTEND_APPFLOWY_CLOUD_URL: "http://appflowy-cloud.productivity.svc.cluster.local:8000"
  APPFLOWY_WEB_URL: "https://appflowy.${SECRET_DOMAIN}"
  APPFLOWY_COLLABORATE_MULTI_THREAD: "false"
  APPFLOWY_COLLABORATE_REMOVE_BATCH_SIZE: "100"

  # Logging
  RUST_LOG: "info"
