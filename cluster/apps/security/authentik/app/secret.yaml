---
apiVersion: v1
kind: Secret
metadata:
  name: authentik-secret
  namespace: security
type: Opaque
stringData:
  AUTHENTIK_POSTGRESQL__HOST: &dbhost "postgres-rw.data.svc.cluster.local"
  AUTHENTIK_POSTGRESQL__NAME: &dbname "authentik"
  AUTHENTIK_POSTGRESQL__USER: &dbuser "${AUTHENTIK_POSTGRES_USER}"
  AUTHENTIK_POSTGRESQL__PASSWORD: &dbpass "${AUTHENTIK_POSTGRES_PASSWORD}"

  AUTHENTIK_STORAGE__MEDIA__BACKEND: "s3"
  AUTHENTIK_STORAGE__MEDIA__S3__ACCESS_KEY: "${MINIO_ACCESS_KEY}"
  AUTHENTIK_STORAGE__MEDIA__S3__SECRET_KEY: "${MINIO_SECRET_KEY}"
  AUTHENTIK_STORAGE__MEDIA__S3__BUCKET_NAME: "${AUTHENTIK_MINIO_BUCKET}"
  AUTHENTIK_STORAGE__MEDIA__S3__REGION: "${MINIO_REGION}"
  AUTHENTIK_STORAGE__MEDIA__S3__ENDPOINT: "https://s3.${SECRET_DOMAIN}"
  AUTHENTIK_STORAGE__MEDIA__S3__CUSTOM_DOMAIN: "s3.${SECRET_DOMAIN}/${AUTHENTIK_MINIO_BUCKET}"

  AUTHENTIK_BOOTSTRAP_EMAIL: "${AUTHENTIK_BOOTSTRAP_EMAIL}"
  AUTHENTIK_BOOTSTRAP_PASSWORD: "${AUTHENTIK_BOOTSTRAP_PASSWORD}"
  AUTHENTIK_BOOTSTRAP_TOKEN: "${AUTHENTIK_BOOTSTRAP_TOKEN}"
  AUTHENTIK_SECRET_KEY: "${AUTHENTIK_SECRET_KEY}"

  AUTHENTIK_EMAIL__HOST: "${MAILGUN_SMTP_HOST}"
  AUTHENTIK_EMAIL__USERNAME: "${MAILGUN_SMTP_USER}"
  AUTHENTIK_EMAIL__PASSWORD: "${MAILGUN_SMTP_PASSWORD}"
  AUTHENTIK_EMAIL__USE_TLS: "true"
  AUTHENTIK_EMAIL__FROM: "auth@${SECRET_DOMAIN}"

  INIT_POSTGRES_HOST: *dbhost
  INIT_POSTGRES_DBNAME: *dbname
  INIT_POSTGRES_USER: *dbuser
  INIT_POSTGRES_PASS: *dbpass
  INIT_POSTGRES_SUPER_USER: "${POSTGRES_SUPER_USER}"
  INIT_POSTGRES_SUPER_PASS: "${POSTGRES_SUPER_PASS}"
